groups:
- neurodata_type_def: RandomSpikesData
  neurodata_type_inc: NWBDataInterface
  default_name: random_spikes
  doc: Random spike indices per unit for waveform extraction and template 
    computation. Stores indices into each unit's spike train as a ragged array.
  attributes:
  - name: method
    dtype: text
    doc: "Method used to select random spikes: 'uniform' (randomly sampled with max
      count) or 'all' (all spikes used)."
  - name: max_spikes_per_unit
    dtype: int32
    doc: Maximum number of spikes to sample per unit. Only used when 
      method='uniform'.
    required: false
  - name: margin_size
    dtype: int32
    doc: Number of samples at the border to exclude from spike selection.
    required: false
  - name: seed
    dtype: int32
    doc: Random seed used for reproducibility when method='uniform'.
    required: false
  datasets:
  - name: random_spikes_indices
    neurodata_type_inc: VectorData
    dtype: int64
    dims:
    - num_spikes_total
    shape:
    - null
    doc: Concatenated array of spike indices for all units. Each value is an 
      index into the spike train for that unit. Use random_spikes_indices_index 
      to retrieve indices for each unit.
  - name: random_spikes_indices_index
    neurodata_type_inc: VectorIndex
    doc: Index into random_spikes_indices for each unit. The indices for unit i 
      are 
      random_spikes_indices[random_spikes_indices_index[i-1]:random_spikes_indices_index[i]].
- neurodata_type_def: TemplatesData
  neurodata_type_inc: NWBDataInterface
  default_name: templates
  doc: Sparse template waveforms per unit. Templates are stored as a ragged 
    array where each unit has waveforms only for its active channels (determined
    by sparsity).
  attributes:
  - name: peak_sample_index
    dtype: int32
    doc: 'The index of the peak sample in the template waveform (0-indexed). This
      is the alignment point used during spike sorting, typically the point of maximum
      absolute amplitude. Combined with the number of samples from the data shape,
      this fully specifies the temporal structure: samples_before = peak_sample_index,
      samples_after = n_samples - peak_sample_index - 1.'
  datasets:
  - name: data
    neurodata_type_inc: VectorData
    dtype: float32
    dims:
    - total_channels
    - num_samples
    shape:
    - null
    - null
    doc: Template waveforms stored sparsely. Shape is 
      (total_active_channels_across_units, num_samples). Use data_index to 
      retrieve templates for each unit, and channel_ids to identify which 
      channel each waveform corresponds to.
    attributes:
    - name: unit
      dtype: text
      default_value: volts
      doc: Unit of measurement for template data.
      required: false
  - name: data_index
    neurodata_type_inc: VectorIndex
    doc: Index into data for each unit. The templates for unit i are 
      data[data_index[i-1]:data_index[i], :].
  - name: channel_ids
    dtype: int32
    dims:
    - total_channels
    shape:
    - null
    doc: Channel identifier for each row in data. Maps each waveform row to its 
      corresponding channel/electrode index.
- neurodata_type_def: SortingAnalyzerExtensions
  neurodata_type_inc: NWBDataInterface
  default_name: extensions
  doc: Container for SortingAnalyzer computed extensions such as templates, 
    random spikes, quality metrics, and other derived data.
  groups:
  - neurodata_type_inc: RandomSpikesData
    doc: Random spikes extension data.
    quantity: '?'
  - neurodata_type_inc: TemplatesData
    doc: Templates extension data.
    quantity: '?'
- neurodata_type_def: SortingAnalyzerContainer
  neurodata_type_inc: NWBDataInterface
  default_name: sorting_analyzer
  doc: Container for SortingAnalyzer data from SpikeInterface. Contains metadata
    about the sorting analysis, links to electrodes and units tables, and 
    computed extension data.
  attributes:
  - name: sampling_frequency
    dtype: float64
    doc: Sampling frequency of the recording in Hz.
  datasets:
  - name: sparsity_mask
    dtype: bool
    dims:
    - num_units
    - num_channels
    shape:
    - null
    - null
    doc: Boolean mask indicating which channels are active (sparse) for each 
      unit. Shape is (num_units, num_channels). True indicates the channel is 
      used for that unit.
    quantity: '?'
  - name: electrodes
    neurodata_type_inc: DynamicTableRegion
    doc: Reference to the electrodes table rows that correspond to the channels 
      used in this sorting analysis. Order matches the channel dimension in 
      templates and sparsity_mask.
  - name: units_region
    neurodata_type_inc: DynamicTableRegion
    doc: Reference to the units table rows that correspond to the units in this 
      sorting analysis. Order matches the unit dimension in all data arrays.
  groups:
  - neurodata_type_inc: SortingAnalyzerExtensions
    doc: Container for computed extension data (templates, random spikes, etc.).
    quantity: '?'
  links:
  - name: source_electrical_series
    target_type: ElectricalSeries
    doc: Link to the ElectricalSeries from which this sorting was derived. 
      Optional - only present for 'with recording' cases.
    quantity: '?'
