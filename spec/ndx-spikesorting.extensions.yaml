groups:
- neurodata_type_def: RandomSpikes
  neurodata_type_inc: NWBDataInterface
  default_name: random_spikes
  doc: Random spike indices per unit for waveform extraction and template 
    computation. Stores indices into each unit's spike train as a ragged array.
  datasets:
  - name: random_spikes_indices
    neurodata_type_inc: VectorData
    dtype: int64
    dims:
    - num_spikes_total
    shape:
    - null
    doc: Concatenated array of spike indices for all units. Each value is an 
      index into the spike train for that unit. Use random_spikes_indices_index 
      to retrieve indices for each unit.
  - name: random_spikes_indices_index
    neurodata_type_inc: VectorIndex
    doc: Index into random_spikes_indices for each unit. The indices for unit i 
      are 
      random_spikes_indices[random_spikes_indices_index[i-1]:random_spikes_indices_index[i]].

- neurodata_type_def: Templates
  neurodata_type_inc: NWBDataInterface
  default_name: templates
  doc: Template waveforms per unit stored as a ragged array. Each row is one
    channel's waveform for one unit. When sparsity is used, only active channels
    are stored per unit. Without sparsity, all channels are stored for each unit.
  attributes:
  - name: peak_sample_index
    dtype: int32
    doc: 'The index of the peak sample in the template waveform (0-indexed). This
      is the alignment point used during spike sorting, typically the point of maximum
      absolute amplitude. Combined with the number of samples from the data shape,
      this fully specifies the temporal structure: samples_before = peak_sample_index,
      samples_after = n_samples - peak_sample_index.'
  datasets:
  - name: data
    neurodata_type_inc: VectorData
    dtype: float32
    dims:
    - num_waveforms
    - num_samples
    shape:
    - null
    - null
    doc: Template waveforms as a ragged array. Shape is
      (total_waveforms, num_samples) where total_waveforms is the sum of
      channels per unit across all units. Use data_index to retrieve
      waveforms for each unit, and electrodes to identify which electrode
      each row corresponds to.
    attributes:
    - name: unit
      dtype: text
      default_value: microvolts
      doc: Unit of measurement for template data.
      required: false
  - name: data_index
    neurodata_type_inc: VectorIndex
    doc: Index into data for each unit. The templates for unit i are
      data[data_index[i-1]:data_index[i], :].
  - name: electrodes
    neurodata_type_inc: DynamicTableRegion
    doc: Reference to the electrodes table for each row in data. Has the
      same length as the first dimension of data, so data_index indexes both
      datasets in lockstep. The electrodes for unit i are
      electrodes[data_index[i-1]:data_index[i]].

- neurodata_type_def: NoiseLevels
  neurodata_type_inc: NWBDataInterface
  default_name: noise_levels
  doc: Noise levels estimated after preprocessing for each channel
  datasets:
  - name: data
    neurodata_type_inc: VectorData
    dtype: float32
    dims:
    - num_channels
    shape:
    - null
    doc: Array of noise levels for each channel.
    attributes:
    - name: unit
      dtype: text
      default_value: microvolts
      doc: Unit of measurement for noise data.
      required: false

- neurodata_type_def: UnitLocations
  neurodata_type_inc: NWBDataInterface
  default_name: unit_locations
  doc: Estimated locations for each unit in x-y and optionally z dimensions.
  datasets:
  - name: locations
    neurodata_type_inc: VectorData
    dtype: float
    dims:
    - - num_units
      - x, y
    - - num_units
      - x, y, z
    shape:
    - - null
      - 2
    - - null
      - 3
    doc: Locations of units. Shape is (num_units, 2) for 2D locations (x-y) or 
      (num_units, 3) for 3D locations (x-y-z).

- neurodata_type_def: SpikeSortingExtensions
  neurodata_type_inc: NWBDataInterface
  default_name: extensions
  doc: Container for spike sorting computed extensions such as templates, random
    spikes, quality metrics, and other derived data.
  groups:
  - neurodata_type_inc: RandomSpikes
    doc: Random spikes extension data.
    quantity: '?'
  - neurodata_type_inc: Templates
    doc: Templates extension data.
    quantity: '?'
  - neurodata_type_inc: NoiseLevels
    doc: Noise levels extension data.
    quantity: '?'
  - neurodata_type_inc: UnitLocations
    doc: Unit locations extension data.
    quantity: '?'

- neurodata_type_def: SpikeSortingContainer
  neurodata_type_inc: NWBDataInterface
  default_name: spike_sorting
  doc: Container for spike sorting results. Contains metadata about the sorting 
    analysis, links to electrodes and units tables, and computed extension data.
  attributes:
  - name: sampling_frequency
    dtype: float64
    doc: Sampling frequency of the recording in Hz.
  datasets:
  - name: sparsity_mask
    dtype: bool
    dims:
    - num_units
    - num_channels
    shape:
    - null
    - null
    doc: Boolean mask indicating which channels are active (sparse) for each 
      unit. Shape is (num_units, num_channels). True indicates the channel is 
      used for that unit.
    quantity: '?'
  - name: electrodes
    neurodata_type_inc: DynamicTableRegion
    doc: Reference to the electrodes table rows that correspond to the channels 
      used in this sorting analysis. Order matches the channel dimension in 
      templates and sparsity_mask.
  - name: units_region
    neurodata_type_inc: DynamicTableRegion
    doc: Reference to the units table rows that correspond to the units in this 
      sorting analysis. Order matches the unit dimension in all data arrays.
  groups:
  - neurodata_type_inc: SpikeSortingExtensions
    doc: Container for computed extension data (templates, random spikes, etc.).
    quantity: '?'
  links:
  - name: source_electrical_series
    target_type: ElectricalSeries
    doc: Link to the ElectricalSeries from which this sorting was derived. 
      Optional - only present for 'with recording' cases.
    quantity: '?'
